<% if (title) { %>
  <h1><%= title %></h1>
<% } else {
  res.redirect('/')
} %>

<%- messages() %>

<% if (vehicles && vehicles.length > 0) { %>
  <form action="/review/add" method="POST" id="reviewForm">
    
    <div class="form-group">
      <label for="inv_id">Select a Vehicle *</label>
      <select name="inv_id" id="inv_id" required <%= preselectedInvId ? 'disabled' : '' %>>
        <option value="">-- Choose a vehicle --</option>
        <% vehicles.forEach(vehicle => { %>
          <option value="<%= vehicle.inv_id %>" 
                  <%= preselectedInvId === vehicle.inv_id ? 'selected' : '' %>>
            <%= vehicle.inv_year %> <%= vehicle.inv_make %> <%= vehicle.inv_model %>
          </option>
        <% }) %>
      </select>
      
      <!-- Hidden field to send the value when select is disabled -->
      <% if (preselectedInvId) { %>
        <input type="hidden" name="inv_id" value="<%= preselectedInvId %>">
      <% } %>
    </div>

    <div class="form-group">
      <label for="rating">Rating (1-5) *</label>
      <div class="rating-input">
        <input type="number" 
               name="rating" 
               id="rating" 
               min="1" 
               max="5" 
               required
               placeholder="Enter a rating from 1 to 5">
        <span class="rating-hint">‚≠ê 1 = Poor, 5 = Excellent</span>
      </div>
    </div>
    
    <div class="form-group">
      <label for="review_text">Your Review *</label>
      <textarea name="review_text" 
                id="review_text" 
                rows="6" 
                required
                placeholder="Share your experience with this vehicle..."></textarea>
      <span class="char-count">Minimum 10 characters</span>
    </div>

    <div class="form-actions">
      <button type="submit" class="btn-primary">Submit Review</button>
      <% if (preselectedInvId) { %>
        <a href="/inv/detail/<%= preselectedInvId %>" class="btn-secondary">Cancel</a>
      <% } else { %>
        <a href="/" class="btn-secondary">Cancel</a>
      <% } %>
    </div>
  </form>
<% } else { %>
  <div class="no-vehicles-message">
    <p>You have already reviewed all available vehicles or there are no vehicles to review at this time.</p>
    <a href="/inv/" class="btn-secondary">Browse Inventory</a>
  </div>
<% } %>